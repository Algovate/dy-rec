# Changelog

## v2.1.0 - TypeScript è¿ç§»

### ğŸ”§ æŠ€æœ¯å‡çº§

#### TypeScript è¿ç§»
- âœ… å®Œæ•´è¿ç§»åˆ° TypeScriptï¼Œæä¾›ç±»å‹å®‰å…¨
- âœ… æ‰€æœ‰æºæ–‡ä»¶ä» `.js` è½¬æ¢ä¸º `.ts`
- âœ… æ·»åŠ å®Œæ•´çš„ç±»å‹å®šä¹‰å’Œæ¥å£
- âœ… é…ç½® TypeScript ç¼–è¯‘å™¨é€‰é¡¹ï¼ˆES2022, NodeNextï¼‰

#### ä»£ç è´¨é‡å·¥å…·
- âœ… é›†æˆ ESLint 9.xï¼ˆä½¿ç”¨æ–°çš„ flat config æ ¼å¼ï¼‰
- âœ… é›†æˆ Prettier ä»£ç æ ¼å¼åŒ–
- âœ… é…ç½® TypeScript ESLint æ’ä»¶
- âœ… æ·»åŠ ä»£ç æ£€æŸ¥å’Œæ ¼å¼åŒ–è„šæœ¬

#### å¼€å‘ä½“éªŒæ”¹è¿›
- âœ… æ·»åŠ  `npm run dev` è„šæœ¬ï¼ˆä½¿ç”¨ tsx ç›´æ¥è¿è¡Œ TypeScriptï¼‰
- âœ… æ·»åŠ  `npm run type-check` è„šæœ¬ï¼ˆä»…ç±»å‹æ£€æŸ¥ï¼Œä¸ç”Ÿæˆæ–‡ä»¶ï¼‰
- âœ… æ”¹è¿›çš„ IDE æ”¯æŒå’Œè‡ªåŠ¨è¡¥å…¨
- âœ… æ›´å¥½çš„é”™è¯¯æç¤ºå’Œç±»å‹æ£€æŸ¥

### ğŸ“ é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ douyinApi.ts          # TypeScript
â”œâ”€â”€ browser.ts                 # TypeScript
â”œâ”€â”€ cli.ts                     # TypeScript
â”œâ”€â”€ config/
â”‚   â””â”€â”€ configManager.ts       # TypeScript
â”œâ”€â”€ flvRecorder.ts             # TypeScript
â”œâ”€â”€ monitor/
â”‚   â”œâ”€â”€ recordingMonitor.ts    # TypeScript
â”‚   â””â”€â”€ roomWatcher.ts         # TypeScript
â”œâ”€â”€ recorders/
â”‚   â”œâ”€â”€ m3u8Recorder.ts        # TypeScript
â”‚   â””â”€â”€ segmentRecorder.ts     # TypeScript
â”œâ”€â”€ streamDetector.ts          # TypeScript
â”œâ”€â”€ taskManager.ts             # TypeScript
â”œâ”€â”€ types/
â”‚   â””â”€â”€ fluent-ffmpeg.d.ts     # ç±»å‹å®šä¹‰
â””â”€â”€ utils.ts                   # TypeScript
```

### ğŸ› ï¸ å¼€å‘å‘½ä»¤

```bash
# ç¼–è¯‘ TypeScript
npm run build

# å¼€å‘æ¨¡å¼ï¼ˆç›´æ¥è¿è¡Œ TSï¼Œæ— éœ€ç¼–è¯‘ï¼‰
npm run dev record -r 379595210124

# ä»£ç æ£€æŸ¥
npm run lint

# è‡ªåŠ¨ä¿®å¤ä»£ç é—®é¢˜
npm run lint:fix

# æ ¼å¼åŒ–ä»£ç 
npm run format

# ç±»å‹æ£€æŸ¥ï¼ˆä¸ç”Ÿæˆæ–‡ä»¶ï¼‰
npm run type-check
```

### âš ï¸ é‡è¦æç¤º

**ç¼–è¯‘æ–¹å¼**ï¼š
- âœ… æ­£ç¡®ï¼šä½¿ç”¨ `npm run build` æˆ– `tsc`ï¼ˆä¸å¸¦å‚æ•°ï¼‰
- âŒ é”™è¯¯ï¼šç›´æ¥è¿è¡Œ `tsc src/cli.ts`ï¼ˆä¸ä¼šä½¿ç”¨ tsconfig.json é…ç½®ï¼‰

### ğŸ“¦ ä¾èµ–æ›´æ–°

#### æ–°å¢å¼€å‘ä¾èµ–
- `typescript`: ^5.9.3
- `tsx`: ^4.21.0
- `@types/node`: ^24.10.2
- `@types/fluent-ffmpeg`: ^2.1.28
- `@typescript-eslint/eslint-plugin`: ^8.49.0
- `@typescript-eslint/parser`: ^8.49.0
- `eslint`: ^9.39.1
- `eslint-config-prettier`: ^10.1.8
- `eslint-plugin-prettier`: ^5.5.4
- `prettier`: ^3.7.4

### ğŸ”„ è¿ç§»è¯´æ˜

æ‰€æœ‰ JavaScript æºæ–‡ä»¶å·²è¿ç§»åˆ° TypeScriptï¼š
- æ‰€æœ‰ `.js` æºæ–‡ä»¶å·²åˆ é™¤
- ä»…ä¿ç•™ `.ts` æºæ–‡ä»¶
- ç¼–è¯‘è¾“å‡ºåˆ° `dist/` ç›®å½•
- ä¿æŒå‘åå…¼å®¹çš„ API

---

## v2.0.0 - å…¨é¢å‡çº§

### ğŸš€ æ ¸å¿ƒåŠŸèƒ½

#### 1. API ç›´è¿æ¨¡å¼
- âœ… ç›´æ¥è°ƒç”¨æŠ–éŸ³ API è·å–æµåœ°å€ï¼ˆé€Ÿåº¦æå‡ 10 å€ï¼‰
- âœ… æ”¯æŒå¤šç§æ¸…æ™°åº¦é€‰æ‹©ï¼ˆåŸç”»ã€è¶…æ¸…ã€é«˜æ¸…ã€æ ‡æ¸…ã€æµç•…ï¼‰
- âœ… åŒæ—¶è·å– FLV å’Œ M3U8 æµåœ°å€

#### 2. æ··åˆæ¨¡å¼
- âœ… API ä¼˜å…ˆï¼Œæµè§ˆå™¨å¤‡ç”¨
- âœ… è‡ªåŠ¨å›é€€æœºåˆ¶ï¼Œæé«˜å¯é æ€§
- âœ… å¯é…ç½®æ£€æµ‹æ¨¡å¼ï¼ˆapi/browser/hybridï¼‰

#### 3. M3U8 æ”¯æŒ
- âœ… æ”¯æŒ HLS æµå½•åˆ¶
- âœ… è‡ªåŠ¨é‡è¿æœºåˆ¶
- âœ… ä¼˜åŒ– HLS æµå¤„ç†

#### 4. é…ç½®æ–‡ä»¶ç®¡ç†
- âœ… JSON é…ç½®æ–‡ä»¶æ”¯æŒ
- âœ… å¤šç›´æ’­é—´é…ç½®
- âœ… çƒ­é‡è½½æ”¯æŒï¼ˆç›‘å¬æ–‡ä»¶å˜åŒ–ï¼‰

#### 5. æ–­çº¿é‡è¿
- âœ… è‡ªåŠ¨æ£€æµ‹å½•åˆ¶ä¸­æ–­
- âœ… æŒ‡æ•°é€€é¿é‡è¯•ç­–ç•¥
- âœ… å¯é…ç½®é‡è¯•æ¬¡æ•°å’Œå»¶è¿Ÿ

#### 6. å¾ªç¯å€¼å®ˆ
- âœ… å®šæ—¶æ£€æŸ¥ç›´æ’­çŠ¶æ€
- âœ… è‡ªåŠ¨å¼€å§‹/åœæ­¢å½•åˆ¶
- âœ… å¼€æ’­/ä¸‹æ’­äº‹ä»¶å›è°ƒ

#### 7. åˆ†æ®µå½•åˆ¶
- âœ… æŒ‰æ—¶é•¿åˆ†å‰²è§†é¢‘
- âœ… æ”¯æŒå¤šç§æ ¼å¼ï¼ˆMP4ã€TSï¼‰
- âœ… è‡ªåŠ¨å‘½åç®¡ç†

#### 8. å¤šç›´æ’­é—´å¹¶å‘
- âœ… åŒæ—¶å½•åˆ¶å¤šä¸ªç›´æ’­é—´
- âœ… å¹¶å‘æ•°é‡é™åˆ¶
- âœ… ä»»åŠ¡çŠ¶æ€è·Ÿè¸ª

### ğŸ“ æ–°å¢æ–‡ä»¶

```
src/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ douyinApi.js          # æŠ–éŸ³ API å®¢æˆ·ç«¯
â”œâ”€â”€ config/
â”‚   â””â”€â”€ configManager.js      # é…ç½®ç®¡ç†å™¨
â”œâ”€â”€ recorders/
â”‚   â”œâ”€â”€ m3u8Recorder.js       # M3U8 å½•åˆ¶å™¨
â”‚   â””â”€â”€ segmentRecorder.js    # åˆ†æ®µå½•åˆ¶å™¨
â”œâ”€â”€ monitor/
â”‚   â”œâ”€â”€ recordingMonitor.js   # å½•åˆ¶ç›‘æ§å™¨
â”‚   â””â”€â”€ roomWatcher.js        # ç›´æ’­é—´ç›‘æ§å™¨
â”œâ”€â”€ streamDetector.js         # æ··åˆæ¨¡å¼æµæ£€æµ‹å™¨
â””â”€â”€ taskManager.js            # ä»»åŠ¡ç®¡ç†å™¨

config/
â””â”€â”€ config.json               # é…ç½®æ–‡ä»¶ç¤ºä¾‹
```

### ğŸ¯ ä½¿ç”¨æ–¹å¼

#### 1. å•æˆ¿é—´å½•åˆ¶ï¼ˆå‘åå…¼å®¹ï¼‰

```bash
# åŸºæœ¬ç”¨æ³•
node src/cli.js record -r 379595210124

# æŒ‡å®šæ¨¡å¼å’Œè´¨é‡
node src/cli.js record -r 379595210124 -m hybrid -q origin

# åˆ†æ®µå½•åˆ¶
node src/cli.js record -r 379595210124 --segment --segment-duration 3600

# ä»…éŸ³é¢‘
node src/cli.js record -r 379595210124 --audio-only
```

#### 2. é…ç½®æ–‡ä»¶æ¨¡å¼

```bash
# ä½¿ç”¨é…ç½®æ–‡ä»¶å½•åˆ¶æ‰€æœ‰å¯ç”¨çš„æˆ¿é—´
node src/cli.js config

# å¯ç”¨ç›‘å¬æ¨¡å¼
node src/cli.js config --watch
```

#### 3. å¾ªç¯å€¼å®ˆæ¨¡å¼

```bash
# ç›‘å¬é…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰æˆ¿é—´ï¼Œè‡ªåŠ¨å½•åˆ¶
node src/cli.js watch

# è‡ªå®šä¹‰æ£€æŸ¥é—´éš”
node src/cli.js watch -i 120
```

### âš™ï¸ é…ç½®æ–‡ä»¶ç¤ºä¾‹

```json
{
  "mode": "hybrid",
  "output": {
    "dir": "./downloads",
    "format": "mp4",
    "segmentDuration": 3600,
    "segmentEnabled": false
  },
  "recording": {
    "quality": "origin",
    "reconnect": true,
    "maxRetries": 3,
    "retryDelay": 5000
  },
  "watch": {
    "enabled": false,
    "interval": 60,
    "autoStart": true
  },
  "rooms": [
    {
      "url": "https://live.douyin.com/379595210124",
      "quality": "origin",
      "enabled": true
    }
  ],
  "api": {
    "cookies": "",
    "proxy": null
  }
}
```

### ğŸ”„ è¿ç§»æŒ‡å—

#### ä» v1.0.0 å‡çº§

æ—§å‘½ä»¤ï¼š
```bash
node src/cli.js -r 379595210124
```

æ–°å‘½ä»¤ï¼ˆå‘åå…¼å®¹ï¼‰ï¼š
```bash
node src/cli.js record -r 379595210124
```

æˆ–è€…ä½¿ç”¨é…ç½®æ–‡ä»¶æ¨¡å¼ï¼š
```bash
# 1. ç¼–è¾‘ config/config.json
# 2. è¿è¡Œ
node src/cli.js config
```

### ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | v1.0.0 | v2.0.0 |
|------|--------|--------|
| æµæ£€æµ‹é€Ÿåº¦ | ~10s | ~2s (API æ¨¡å¼) |
| å†…å­˜å ç”¨ | 300MB | 100MB (API æ¨¡å¼) |
| å¹¶å‘èƒ½åŠ› | 1 | 5+ |
| ç¨³å®šæ€§ | ä¸­ | é«˜ï¼ˆæ–­çº¿é‡è¿ï¼‰ |

### ğŸ› å·²çŸ¥é—®é¢˜

1. API æ¨¡å¼å¯èƒ½éœ€è¦ Cookieï¼ˆæŠ–éŸ³é£æ§ï¼‰
2. æµè§ˆå™¨æ¨¡å¼ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆï¼Œé€Ÿåº¦è¾ƒæ…¢ä½†æ›´å¯é 

### ğŸ”® æœªæ¥è®¡åˆ’

- [ ] æ·»åŠ æ¶ˆæ¯æ¨é€ï¼ˆé’‰é’‰ã€å¾®ä¿¡ã€Telegramï¼‰
- [ ] æ”¯æŒæ›´å¤šç›´æ’­å¹³å°
- [ ] Web UI ç•Œé¢
- [ ] Docker å®¹å™¨åŒ–

noteId: "cc279080d56a11f08403d1baf424f192"
tags: []

---

